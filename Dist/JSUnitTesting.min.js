var JsUnitTesting=JsUnitTesting||{};JsUnitTesting.Utility=function(t){(t=t||{}).isNil=function(t){return null==t},t.toArray=function(t){return void 0===t?[]:null!==t&&t instanceof Array?t:[t]},t.mapArray=function(i,e,n){var r,s=[];if(i=t.toArray(),t.isNil(e))r=function(t){return e(i[t],t,i)};else{if("function"!=typeof e)throw"callback must be a callback if it is defined";r=function(t){return e.call(n,i[t],t,i)}}if(0==i.length)return s;for(var o=0;o<i.length;o++)s.push(r(o));return s},t.filterArray=function(i,e,n){var r,s=[];if(i=t.toArray(),t.isNil(e))r=function(t){return e(i[t],t,i)};else{if("function"!=typeof e)throw"callback must be a callback if it is defined";r=function(t){return e.call(n,i[t],t,i)}}if(0==i.length)return s;for(var o=0;o<i.length;o++)r(o)&&s.push(i[o]);return s},t.reduceArray=function(i,e,n,r){var s;if(i=t.toArray(),t.isNil(e))s=function(t,n){return e(n,i[t],t,i)};else{if("function"!=typeof e)throw"callback must be a callback if it is defined";s=function(t,n){return e.call(r,n,i[t],t,i)}}var o=n;if(0==i.length)return o;null===typeof o&&(o=i[i.length-1]);for(var u=0;u<i.length;u++)o=s(o,u);return o},t.convertToString=function(i,e){if(t.isNil(i))return void 0===e?i:null===e?e:t.convertToString(e);switch(typeof i){case"string":return i;case"number":case"boolean":return i.toString()}return JSON.stringify(i)},t.convertToNumber=function(i,e){if(t.isNil(i))return void 0===e?i:null===e?e:t.convertToNumber(e);switch(typeof i){case"number":if(!isNaN(i))return i;break;case"boolean":return i?1:0;default:if(i instanceof Date)return i.valueOf();var n=t.convertToString(i,"").trim();if(n.length>0)try{var r=parseInt(n);try{var s=parseFloat(n);i=isNaN(r)?s:isNaN(s)||!Number.isFinite(s)?r:Number.isFinite(r)&&r==s?r:s}catch(t){i=r}}catch(t){i=Number.NaN}else i=Number.NaN;if(!isNaN(i))return i}return void 0===e?i:null===e?e:t.convertToNumber(e)},t.getFunctionName=function(t){if(null!=t){if("function"==typeof t&&"string"==typeof t.name&&t.name.length>0)return t.name;if("function"==typeof t.constructor&&"string"==typeof t.constructor.name&&t.constructor.name.length>0)return t.constructor.name;var i;if(void 0!==t.prototype&&null!==t.prototype&&"function"==typeof t.prototype.constructor)i=t.prototype;else{var e=Object.getPrototypeOf(t);null!=e&&"function"==typeof e.constructor&&(i=e)}if(null!=i&&"string"==typeof i.constructor.name&&i.constructor.name.length>0)return i.constructor.name;var n=/^function\s+([^(]+)/i.exec(t.toString());if(null!=n)return n[1]}return""}}(JsUnitTesting.Utility),JsUnitTesting.TypeSpec=function(t){function i(e){if(this.prototypeChain=[],this.is=function(t){if(null==t||!(t instanceof i))return this.is(new i(t));if(this.prototypeChain.length<t.prototypeChain.length)return!1;if(this.type!=t.type)return!(this.prototypeChain.length>0)&&("(nil)"===this.type?"(null)"===t.type||"undefined"===t.type:"(nil)"===t.type&&("(null)"===this.type||"undefined"===this.type));for(var e=this.prototypeChain.length-t.prototypeChain.length,n=0;n<t.prototypeChain.length;n++)if(this.prototypeChain[n+e]!=t.prototypeChain[n])return!1;return!0},0==arguments.length)return this.value=null,void(this.type="(nil)");if(this.value=e,2!=arguments.length){if(this.type=i.getTypeName(e),"undefined"!=this.type&&"(null)"!=this.type){var n=Object.getPrototypeOf(e);for(t.isNil(n)&&(n=e.prototype);!t.isNil(n);){var r=i.getTypeName(n);"object"!==r&&"function"!==r&&this.prototypeChain.push(r),n=Object.getPrototypeOf(n),t.isNil(n)&&(n=n.prototype)}}}else this.type=t.convertToString(arguments[1],i.getTypeName(e))}return i.getTypeName=function(e){var n,r=typeof e;if("function"===r){if("string"==typeof e.name&&e.name.length>0)return e.name;if(n=t.getFunctionName(e),!t.isNil(n))return n}else{if("object"!==r)return r;if(null===e)return"(null)"}if("function"==typeof e.constructor&&"function"!==(n=i.getTypeName(e.constructor))&&"object"!==n)return n;if(!t.isNil(e.prototype)&&"function"!==(n=i.getTypeName(e.prototype))&&"object"!==n)return n;var s=Object.getPrototypeOf(e);return t.isNil(s)||"function"===(n=i.getTypeName(s))?r:n},i.is=function(t,e){return new i(t).is(new i(e))},i}(JsUnitTesting.Utility),JsUnitTesting.TestResult=function(t,i){return function(e,n,r,s,o,u){var l=function(t,i){return new Assert(r,s),t.apply(void 0,i)},a={stateInfo:u,unitTestId:t.isNil(o)?t.isNil(r.id)?null:r.id:o,unitTestName:r.name,testCollectionId:t.isNil(s)?null:s.id,testCollectionName:t.isNil(s)?null:s.name};try{if(this.result=new i(l.call(this,e,r.args)),this.evaluationFinished=!0,"function"==typeof n){var h=l.call(this,n,[result.value]);if("boolean"==typeof h)this.success=h;else{var f=t.convertToString(h,"").trim();f.length>0&&(t.convertToString(a.message,"").trim().length>0?a.message+="\n\n"+f:a.message=f),this.success=!0}}else void 0===a.success?(this.success=void 0===a.error||null===a.error,this.success||(this.error=a.error)):(void 0!==a.error&&null!==a.error||(this.error=a.error),this.success=a.success&&!0);this.uncaughtExceptionOcurred=!1}catch(t){this.uncaughtExceptionOcurred=!0,void 0===this.evaluationFinished&&(this.evaluationFinished=!1,this.result=new i),this.success=!1,this.error=t}"string"!=typeof a.message&&(a.message=t.convertToString(a.message,"").trim()),0==a.message.length&&(a.message=this.success?"Success":"Fail",t.isNil(this.error)||(a.message=t.convertToString(this.error,a.message).trim())),this.unitTestId=t.isNil(o)?t.isNil(r.id)?null:r.id:o,this.unitTestName=r.name,this.testCollectionId=t.isNil(s)?null:s.id,this.testCollectionName=t.isNil(s)?null:s.name,this.message=a.message}}(JsUnitTesting.Utility,JsUnitTesting.TypeSpec),JsUnitTesting.UnitTest=function(t,i){return function(t,e,n,r,s,o){if("function"!=typeof t){if(void 0===t)throw"testFunc must be defined";if(null===t)throw"testFunc cannot be null";throw"evaluator must be a function"}if("function"!=typeof o&&null!==o)throw"assertion must be a function if it is defined";void 0===(s=JsUnitTesting.Utility.convertToNumber(s))||null==s||isNaN(s)||(this.id=s),(n=JsUnitTesting.Utility.convertToString(n,"")).trim().length>0?this.name=n:(n=JsUnitTesting.Utility.getFunctionName(t),void 0!==this.id&&(n=0==n.length?this.id.toString():n+" ["+this.id+"]")),this.name=n,this.description=JsUnitTesting.Utility.convertToString(r,""),this.toString=function(){return this.toJSON()},this.toJSON=function(){JSON.stringify({args:this.args,name:this.name,description:this.description,id:this.id})},this.valueOf=function(){return void 0===this.id?Number.NaN:this.id},this.exec=function(e,n,r){return new i(t,o,this,e,n,r)}}}(JsUnitTesting.Utility,JsUnitTesting.TestResult),JsUnitTesting.TestCollection=function(t,i){return function(e,r,s){this.notRun=[],this.__resultInfo=[],this.name=t.convertToString(r),this.id=t.convertToNumber(s),this.add=function(){for(var e=0;e<arguments.length;e++)for(var n=t.toArray(arguments[e]),r=0;r<n.length;r++)void 0!==n[r]&&null!==n[r]&&n[r]instanceof i&&this.notRun.push(n[r])},this.clear=function(){this.notRun=[],this.__resultInfo=[]},this.getPassedTests=function(){return t.mapArray(t.filterArray(this.__resultInfo,function(t){return t.result.passed}),function(t){return t.test})},this.getFailedTests=function(){return t.mapArray(t.filterArray(this.__resultInfo,function(t){return!t.result.passed}),function(t){return t.test})},this.getResults=function(){return t.mapArray(this.__resultInfo,function(t){return!t.result.passed})},this.allPassed=function(){for(var t=0;t<this.__resultInfo.length;t++)if(!this.__resultInfo[t].result.passed)return!1;return!0},this.anyPassed=function(){for(var t=0;t<this.__resultInfo.length;t++)if(this.__resultInfo[t].result.passed)return!0;return!1},this.run=function(){for(var i=0,e=0,r=t.mapArray(this.__resultInfo,function(t){return t.result.testId}),s={},o=[];this.notRun.length>0;){var u=this.notRun.pop();if(t.nil(u))return null;e++;var l=u.id;"number"==typeof l&&!isNaN(l)&&Number.isFinite(l)||(l=0);for(var a=!0,h=0;h<r.length;h++)if(r[h]==n){a=!1;break}if(!a){var f=function(t){for(var i=0;i<this.completed.length;i++)if("number"==typeof(e=this.completed[i].id)&&!isNaN(e)&&Number.isFinite(e)&&e==t)return!0;for(i=0;i<this.notRun.length;i++){var e;if("number"==typeof(e=this.notRun[i].id)&&!isNaN(e)&&Number.isFinite(e)&&e==t)return!0}return!1};do{l++}while(f(l))}r.push(l);var c=u.exec(this,l,s);this.__resultInfo.push({test:u,result:c}),o.push(c),c.passed&&i++}return{passed:i,failed:e-passed,results:o}},this.runAll=function(){for(var i=0,e=t.mapArray(this.__resultInfo,function(t){return t.test}),r=0;r<e.length;r++)this.notRun.push(e[r]);this.__resultInfo=[];for(var s=[],o={};this.notRun.length>0;){var u=this.notRun.pop();if(t.nil(u))return null;var l=u.id;"number"==typeof l&&!isNaN(l)&&Number.isFinite(l)||(l=0);var a=!0;for(r=0;r<s.length;r++)if(s[r]==n){a=!1;break}if(!a){var h=function(t){for(var i=0;i<this.completed.length;i++)if("number"==typeof(e=this.completed[i].id)&&!isNaN(e)&&Number.isFinite(e)&&e==t)return!0;for(i=0;i<this.notRun.length;i++){var e;if("number"==typeof(e=this.notRun[i].id)&&!isNaN(e)&&Number.isFinite(e)&&e==t)return!0}return!1};do{l++}while(h(l))}s.push(l);var f=u.exec(this,l,o);this.__resultInfo.push({test:u,result:f}),f.passed&&i++}return{passed:i,failed:this.__resultInfo.count-i,results:this.getResults()}},this.runFailed=function(){for(var i=0,e=0,r=t.mapArray(t.filterArray(this.__resultInfo,function(t){return!t.result.passed}),function(t){return t.test}),s=0;s<this.notRun.length;s++)r.push(this.notRun[s]);this.notRun=r,this.__resultInfo=t.filterArray(this.__resultInfo,function(t){return t.result.passed});for(var o=t.mapArray(this.__resultInfo,function(t){return t.result.testId}),u={},l=[];this.notRun.length>0;){var a=this.notRun.pop();if(t.nil(a))return null;e++;var h=a.id;"number"==typeof h&&!isNaN(h)&&Number.isFinite(h)||(h=0);var f=!0;for(s=0;s<o.length;s++)if(o[s]==n){f=!1;break}if(!f){var c=function(t){for(var i=0;i<this.completed.length;i++)if("number"==typeof(e=this.completed[i].id)&&!isNaN(e)&&Number.isFinite(e)&&e==t)return!0;for(i=0;i<this.notRun.length;i++){var e;if("number"==typeof(e=this.notRun[i].id)&&!isNaN(e)&&Number.isFinite(e)&&e==t)return!0}return!1};do{h++}while(c(h))}o.push(h);var p=a.exec(this,h,u);this.__resultInfo.push({test:a,result:p}),l.push(p),p.passed&&i++}return{passCount:i,failed:e-i,results:l}},this.add(e)}}(JsUnitTesting.Utility,JsUnitTesting.UnitTest),JsUnitTesting.AssertionError=function(t,i,e){function n(i,n,r,s,o,u,l,a){n=t.convertToString(n),null!==(i=t.convertToNumber(i,null))&&Number.isFinite(i)?(this.errorNumber=i,n=0==n.length?"Error "+i:"Error "+i+": "+n):0==n.length&&(n="Unexpected Error"),Error.prototype.constructor.call(this,n),t.isNil(o)?this.innerError="":this.innerError=o,t.isNil(r)?(this.unitTestId="",this.unitTestName=""):(t.isNil(r.id)?this.unitTestId="":this.unitTestId=r.id,t.isNil(r.name)?this.unitTestName="":this.unitTestName=r.name),t.isNil(s)?(this.testCollectionId="",this.testCollectionName=""):(t.isNil(s.id)?this.testCollectionId="":this.testCollectionId=s.id,t.isNil(s.name)?this.testCollectionName="":this.testCollectionName=s.name),a=t.convertToString(a,""),this.condition=0==a.length?"equal to":a,t.isNil(u)?this.expected={}:this.expected=u instanceof e?u:new e(u),t.isNil(l)?this.actual={}:this.actual=l instanceof e?l:new e(l)}return n.prototype=Error.prototype,n.prototype.constructor=n,n}(JsUnitTesting.Utility,JsUnitTesting.UnitTest,JsUnitTesting.TypeSpec),JsUnitTesting.Assert=function(t,i,e){function n(n,r){if(t.isNil(n))throw"JsUnitTesting.UnitTest object must be provided.";if(!(n instanceof JsUnitTesting.UnitTest))throw"The unit test object must be an instance of JsUnitTesting.UnitTest";if(!(t.isNil(r)||r instanceof JsUnitTesting.TestCollection))throw"If test collection is provided, it must be an instance of JsUnitTesting.TestCollection";this.fail=function(t,e,n){throw new i(e,t,this.unitTest,this.testCollection,n,void 0,void 0,"fail")},this.isNil=function(n,r,s){if(!t.isNil(n))throw new i(s,r,this.unitTest,this.testCollection,innerError,new e,new e(n),"is nil")},this.notNil=function(n,r,s){if(t.isNil(n))throw new i(s,r,this.unitTest,this.testCollection,innerError,new e,new e(n),"not nil")},this.is=function(t,n,r,s){if(!e.is(n,t))throw new i(s,r,this.unitTest,this.testCollection,innerError,new e(t),new e(n))},this.isNot=function(t,n,r,s){if(e.is(n,t))throw new i(s,r,this.unitTest,this.testCollection,innerError,new e(t),new e(n),"is not")},this.areEqual=function(t,n,r,s){var o=typeof t;if(o!==typeof n||"undefined"!==o&&null!==t&&t!==n)throw new i(s,r,this.unitTest,this.testCollection,innerError,new e(t),new e(n),"strictly equal to")},this.areNotEqual=function(t,n,r,s){var o=typeof t;if(o===typeof n&&("undefined"===o||null===t||t===n))throw new i(s,r,this.unitTest,this.testCollection,innerError,new e(t),new e(n),"not strictly equal to")},this.areLike=function(n,r,s,o){if(t.isNil(n)){if(t.isNil(r))return}else if(!t.isNil(r)&&n==r)return;throw new i(o,s,this.unitTest,this.testCollection,innerError,new e(n),new e(r))},this.areNotLike=function(n,r,s,o){if(t.isNil(n)){if(!t.isNil(r))return}else if(t.isNil(r)||n!=r)return;throw new i(o,s,this.unitTest,this.testCollection,innerError,new e(n),new e(r),"not equal to")},this.isLessThan=function(n,r,s,o){if(t.isNil(n)||!(t.isNil(r)||r<n))throw new i(o,s,this.unitTest,this.testCollection,innerError,new e(n),new e(r),"is less than")},this.notLessThan=function(n,r,s,o){if(!(t.isNil(n)||!t.isNil(r)&&r>=n))throw new i(o,s,this.unitTest,this.testCollection,innerError,new e(n),new e(r),"is not less than")},this.isGreaterThan=function(n,r,s,o){if(t.isNil(r)||!(t.isNil(n)||r>n))throw new i(o,s,this.unitTest,this.testCollection,innerError,new e(n),new e(r),"is greater than")},this.notGreaterThan=function(n,r,s,o){if(!(t.isNil(r)||!t.isNil(n)&&r<=n))throw new i(o,s,this.unitTest,this.testCollection,innerError,new e(n),new e(r),"is not greater than")},this.isTrue=function(t,i,e){return this.areLike(!0,t,i,e)},this.isFalse=function(t,i,e){return this.areLike(!1,t,i,e)}}return n.fail=n.prototype.fail,n.isNil=n.prototype.isNil,n.notNil=n.prototype.notNil,n.is=n.prototype.is,n.isNot=n.prototype.isNot,n.areEqual=n.prototype.areEqual,n.areNotEqual=n.prototype.areNotEqual,n.areLike=n.prototype.areLike,n.areNotLike=n.prototype.areNotLike,n.isLessThan=n.prototype.isLessThan,n.notLessThan=n.prototype.notLessThan,n.isGreaterThan=n.prototype.isGreaterThan,n.notGreaterThan=n.prototype.notGreaterThan,n.isTrue=n.prototype.isTrue,n.isFalse=n.prototype.isFalse,n}(JsUnitTesting.Utility,JsUnitTesting.AssertionError,JsUnitTesting.TypeSpec);