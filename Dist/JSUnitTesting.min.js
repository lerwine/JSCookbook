var JsUnitTesting=JsUnitTesting||{};JsUnitTesting.Utility=function(u){(u=u||{}).isNil=function(t){return null==t},u.toArray=function(t){return void 0===t?[]:null!==t&&t instanceof Array?t:[t]},u.mapArray=function(i,e,n){var t,r=[];if(i=u.toArray(),u.isNil(e))t=function(t){return e(i[t],t,i)};else{if("function"!=typeof e)throw"callback must be a callback if it is defined";t=function(t){return e.call(n,i[t],t,i)}}if(0==i.length)return r;for(var s=0;s<i.length;s++)r.push(t(s));return r},u.filterArray=function(i,e,n){var t,r=[];if(i=u.toArray(),u.isNil(e))t=function(t){return e(i[t],t,i)};else{if("function"!=typeof e)throw"callback must be a callback if it is defined";t=function(t){return e.call(n,i[t],t,i)}}if(0==i.length)return r;for(var s=0;s<i.length;s++)t(s)&&r.push(i[s]);return r},u.reduceArray=function(e,n,t,r){var i;if(e=u.toArray(),u.isNil(n))i=function(t,i){return n(i,e[t],t,e)};else{if("function"!=typeof n)throw"callback must be a callback if it is defined";i=function(t,i){return n.call(r,i,e[t],t,e)}}var s=t;if(0==e.length)return s;null===typeof s&&(s=e[e.length-1]);for(var o=0;o<e.length;o++)s=i(s,o);return s},u.convertToString=function(t,i){if(u.isNil(t))return void 0===i?t:null===i?i:u.convertToString(i);switch(typeof t){case"string":return t;case"number":case"boolean":return t.toString()}return JSON.stringify(t)},u.convertToNumber=function(i,t){if(u.isNil(i))return void 0===t?i:null===t?t:u.convertToNumber(t);switch(typeof i){case"number":if(!isNaN(i))return i;break;case"boolean":return i?1:0;default:if(i instanceof Date)return i.valueOf();var e=u.convertToString(i,"").trim();if(0<e.length)try{var n=parseInt(e);try{var r=parseFloat(e);i=isNaN(n)?r:isNaN(r)||!Number.isFinite(r)?n:Number.isFinite(n)&&n==r?n:r}catch(t){i=n}}catch(t){i=Number.NaN}else i=Number.NaN;if(!isNaN(i))return i}return void 0===t?i:null===t?t:u.convertToNumber(t)},u.getFunctionName=function(t){if(null!=t){if("function"==typeof t&&"string"==typeof t.name&&0<t.name.length)return t.name;if("function"==typeof t.constructor&&"string"==typeof t.constructor.name&&0<t.constructor.name.length)return t.constructor.name;var i;if(void 0!==t.prototype&&null!==t.prototype&&"function"==typeof t.prototype.constructor)i=t.prototype;else{var e=Object.getPrototypeOf(t);null!=e&&"function"==typeof e.constructor&&(i=e)}if(null!=i&&"string"==typeof i.constructor.name&&0<i.constructor.name.length)return i.constructor.name;var n=/^function\s+([^(]+)/i.exec(t.toString());if(null!=n)return n[1]}return""}}(JsUnitTesting.Utility),JsUnitTesting.TypeSpec=function(r){function s(t){if(this.prototypeChain=[],this.is=function(t){if(null==t||!(t instanceof s))return this.is(new s(t));if(this.prototypeChain.length<t.prototypeChain.length)return!1;if(this.type!=t.type)return!(0<this.prototypeChain.length)&&("(nil)"===this.type?"(null)"===t.type||"undefined"===t.type:"(nil)"===t.type&&("(null)"===this.type||"undefined"===this.type));for(var i=this.prototypeChain.length-t.prototypeChain.length,e=0;e<t.prototypeChain.length;e++)if(this.prototypeChain[e+i]!=t.prototypeChain[e])return!1;return!0},0==arguments.length)return this.value=null,void(this.type="(nil)");if(this.value=t,2!=arguments.length){if(this.type=s.getTypeName(t),"undefined"!=this.type&&"(null)"!=this.type){var i=Object.getPrototypeOf(t);for(r.isNil(i)&&(i=t.prototype);!r.isNil(i);){var e=s.getTypeName(i);"object"!==e&&"function"!==e&&this.prototypeChain.push(e),i=Object.getPrototypeOf(i),r.isNil(i)&&(i=i.prototype)}}}else this.type=r.convertToString(arguments[1],s.getTypeName(t))}return s.getTypeName=function(t){var i,e=typeof t;if("function"===e){if("string"==typeof t.name&&0<t.name.length)return t.name;if(i=r.getFunctionName(t),!r.isNil(i))return i}else{if("object"!==e)return e;if(null===t)return"(null)"}if("function"==typeof t.constructor&&"function"!==(i=s.getTypeName(t.constructor))&&"object"!==i)return i;if(!r.isNil(t.prototype)&&"function"!==(i=s.getTypeName(t.prototype))&&"object"!==i)return i;var n=Object.getPrototypeOf(t);return r.isNil(n)||"function"===(i=s.getTypeName(n))?e:i},s.is=function(t,i){return new s(t).is(new s(i))},s}(JsUnitTesting.Utility),JsUnitTesting.TestResult=function(h,f){return function(t,i,e,n,r,s){var o=function(t,i){return new Assert(e,n),t.apply(void 0,i)},u={stateInfo:s,unitTestId:h.isNil(r)?h.isNil(e.id)?null:e.id:r,unitTestName:e.name,testCollectionId:h.isNil(n)?null:n.id,testCollectionName:h.isNil(n)?null:n.name};try{if(this.result=new f(o.call(this,t,e.args)),this.evaluationFinished=!0,"function"==typeof i){var l=o.call(this,i,[result.value]);if("boolean"==typeof l)this.success=l;else{var a=h.convertToString(l,"").trim();0<a.length&&(0<h.convertToString(u.message,"").trim().length?u.message+="\n\n"+a:u.message=a),this.success=!0}}else void 0===u.success?(this.success=void 0===u.error||null===u.error,this.success||(this.error=u.error)):(void 0!==u.error&&null!==u.error||(this.error=u.error),this.success=u.success&&!0);this.uncaughtExceptionOcurred=!1}catch(t){this.uncaughtExceptionOcurred=!0,void 0===this.evaluationFinished&&(this.evaluationFinished=!1,this.result=new f),this.success=!1,this.error=t}"string"!=typeof u.message&&(u.message=h.convertToString(u.message,"").trim()),0==u.message.length&&(u.message=this.success?"Success":"Fail",h.isNil(this.error)||(u.message=h.convertToString(this.error,u.message).trim())),this.unitTestId=h.isNil(r)?h.isNil(e.id)?null:e.id:r,this.unitTestName=e.name,this.testCollectionId=h.isNil(n)?null:n.id,this.testCollectionName=h.isNil(n)?null:n.name,this.message=u.message}}(JsUnitTesting.Utility,JsUnitTesting.TypeSpec),JsUnitTesting.UnitTest=function(t,o){return function(n,t,i,e,r,s){if("function"!=typeof n){if(void 0===n)throw"testFunc must be defined";if(null===n)throw"testFunc cannot be null";throw"evaluator must be a function"}if("function"!=typeof s&&null!==s)throw"assertion must be a function if it is defined";void 0===(r=JsUnitTesting.Utility.convertToNumber(r))||null==r||isNaN(r)||(this.id=r),0<(i=JsUnitTesting.Utility.convertToString(i,"")).trim().length?this.name=i:(i=JsUnitTesting.Utility.getFunctionName(n),void 0!==this.id&&(i=0==i.length?this.id.toString():i+" ["+this.id+"]")),this.name=i,this.description=JsUnitTesting.Utility.convertToString(e,""),this.toString=function(){return this.toJSON()},this.toJSON=function(){JSON.stringify({args:this.args,name:this.name,description:this.description,id:this.id})},this.valueOf=function(){return void 0===this.id?Number.NaN:this.id},this.exec=function(t,i,e){return new o(n,s,this,t,i,e)}}}(JsUnitTesting.Utility,JsUnitTesting.TestResult),JsUnitTesting.TestCollection=function(p,r){return function(t,i,e){this.notRun=[],this.__resultInfo=[],this.name=p.convertToString(i),this.id=p.convertToNumber(e),this.add=function(){for(var t=0;t<arguments.length;t++)for(var i=p.toArray(arguments[t]),e=0;e<i.length;e++)void 0!==i[e]&&null!==i[e]&&i[e]instanceof r&&this.notRun.push(i[e])},this.clear=function(){this.notRun=[],this.__resultInfo=[]},this.getPassedTests=function(){return p.mapArray(p.filterArray(this.__resultInfo,function(t){return t.result.passed}),function(t){return t.test})},this.getFailedTests=function(){return p.mapArray(p.filterArray(this.__resultInfo,function(t){return!t.result.passed}),function(t){return t.test})},this.getResults=function(){return p.mapArray(this.__resultInfo,function(t){return!t.result.passed})},this.allPassed=function(){for(var t=0;t<this.__resultInfo.length;t++)if(!this.__resultInfo[t].result.passed)return!1;return!0},this.anyPassed=function(){for(var t=0;t<this.__resultInfo.length;t++)if(this.__resultInfo[t].result.passed)return!0;return!1},this.run=function(){for(var t=0,i=0,e=p.mapArray(this.__resultInfo,function(t){return t.result.testId}),r={},s=[];0<this.notRun.length;){var o=this.notRun.pop();if(p.nil(o))return null;i++;var u=o.id;"number"==typeof u&&!isNaN(u)&&Number.isFinite(u)||(u=0);for(var l=!0,a=0;a<e.length;a++)if(e[a]==n){l=!1;break}if(!l)for(var h=function(t){for(var i=0;i<this.completed.length;i++)if("number"==typeof(e=this.completed[i].id)&&!isNaN(e)&&Number.isFinite(e)&&e==t)return!0;for(i=0;i<this.notRun.length;i++){var e;if("number"==typeof(e=this.notRun[i].id)&&!isNaN(e)&&Number.isFinite(e)&&e==t)return!0}return!1};h(++u););e.push(u);var f=o.exec(this,u,r);this.__resultInfo.push({test:o,result:f}),s.push(f),f.passed&&t++}return{passed:t,failed:i-passed,results:s}},this.runAll=function(){for(var t=0,i=p.mapArray(this.__resultInfo,function(t){return t.test}),e=0;e<i.length;e++)this.notRun.push(i[e]);this.__resultInfo=[];for(var r=[],s={};0<this.notRun.length;){var o=this.notRun.pop();if(p.nil(o))return null;var u=o.id;"number"==typeof u&&!isNaN(u)&&Number.isFinite(u)||(u=0);var l=!0;for(e=0;e<r.length;e++)if(r[e]==n){l=!1;break}if(!l)for(var a=function(t){for(var i=0;i<this.completed.length;i++)if("number"==typeof(e=this.completed[i].id)&&!isNaN(e)&&Number.isFinite(e)&&e==t)return!0;for(i=0;i<this.notRun.length;i++){var e;if("number"==typeof(e=this.notRun[i].id)&&!isNaN(e)&&Number.isFinite(e)&&e==t)return!0}return!1};a(++u););r.push(u);var h=o.exec(this,u,s);this.__resultInfo.push({test:o,result:h}),h.passed&&t++}return{passed:t,failed:this.__resultInfo.count-t,results:this.getResults()}},this.runFailed=function(){for(var t=0,i=0,e=p.mapArray(p.filterArray(this.__resultInfo,function(t){return!t.result.passed}),function(t){return t.test}),r=0;r<this.notRun.length;r++)e.push(this.notRun[r]);this.notRun=e,this.__resultInfo=p.filterArray(this.__resultInfo,function(t){return t.result.passed});for(var s=p.mapArray(this.__resultInfo,function(t){return t.result.testId}),o={},u=[];0<this.notRun.length;){var l=this.notRun.pop();if(p.nil(l))return null;i++;var a=l.id;"number"==typeof a&&!isNaN(a)&&Number.isFinite(a)||(a=0);var h=!0;for(r=0;r<s.length;r++)if(s[r]==n){h=!1;break}if(!h)for(var f=function(t){for(var i=0;i<this.completed.length;i++)if("number"==typeof(e=this.completed[i].id)&&!isNaN(e)&&Number.isFinite(e)&&e==t)return!0;for(i=0;i<this.notRun.length;i++){var e;if("number"==typeof(e=this.notRun[i].id)&&!isNaN(e)&&Number.isFinite(e)&&e==t)return!0}return!1};f(++a););s.push(a);var c=l.exec(this,a,o);this.__resultInfo.push({test:l,result:c}),u.push(c),c.passed&&t++}return{passCount:t,failed:i-t,results:u}},this.add(t)}}(JsUnitTesting.Utility,JsUnitTesting.UnitTest),JsUnitTesting.AssertionError=function(l,t,a){function i(t,i,e,n,r,s,o,u){i=l.convertToString(i),null!==(t=l.convertToNumber(t,null))&&Number.isFinite(t)?(this.errorNumber=t,i=0==i.length?"Error "+t:"Error "+t+": "+i):0==i.length&&(i="Unexpected Error"),Error.prototype.constructor.call(this,i),l.isNil(r)?this.innerError="":this.innerError=r,l.isNil(e)?(this.unitTestId="",this.unitTestName=""):(l.isNil(e.id)?this.unitTestId="":this.unitTestId=e.id,l.isNil(e.name)?this.unitTestName="":this.unitTestName=e.name),l.isNil(n)?(this.testCollectionId="",this.testCollectionName=""):(l.isNil(n.id)?this.testCollectionId="":this.testCollectionId=n.id,l.isNil(n.name)?this.testCollectionName="":this.testCollectionName=n.name),u=l.convertToString(u,""),this.condition=0==u.length?"equal to":u,l.isNil(s)?this.expected={}:this.expected=s instanceof a?s:new a(s),l.isNil(o)?this.actual={}:this.actual=o instanceof a?o:new a(o)}return(i.prototype=Error.prototype).constructor=i}(JsUnitTesting.Utility,JsUnitTesting.UnitTest,JsUnitTesting.TypeSpec),JsUnitTesting.Assert=function(r,s,o){function t(t,i){if(r.isNil(t))throw"JsUnitTesting.UnitTest object must be provided...";if(!(t instanceof JsUnitTesting.UnitTest))throw"The unit test object must be an instance of JsUnitTesting.UnitTest";if(!(r.isNil(i)||i instanceof JsUnitTesting.TestCollection))throw"If test collection is provided, it must be an instance of JsUnitTesting.TestCollection";this.fail=function(t,i,e){throw new s(i,t,this.unitTest,this.testCollection,e,void 0,void 0,"fail")},this.isNil=function(t,i,e){if(!r.isNil(t))throw new s(e,i,this.unitTest,this.testCollection,innerError,new o,new o(t),"is nil")},this.notNil=function(t,i,e){if(r.isNil(t))throw new s(e,i,this.unitTest,this.testCollection,innerError,new o,new o(t),"not nil")},this.is=function(t,i,e,n){if(!o.is(i,t))throw new s(n,e,this.unitTest,this.testCollection,innerError,new o(t),new o(i))},this.isNot=function(t,i,e,n){if(o.is(i,t))throw new s(n,e,this.unitTest,this.testCollection,innerError,new o(t),new o(i),"is not")},this.areEqual=function(t,i,e,n){var r=typeof t;if(r!==typeof i||"undefined"!==r&&null!==t&&t!==i)throw new s(n,e,this.unitTest,this.testCollection,innerError,new o(t),new o(i),"strictly equal to")},this.areNotEqual=function(t,i,e,n){var r=typeof t;if(r===typeof i&&("undefined"===r||null===t||t===i))throw new s(n,e,this.unitTest,this.testCollection,innerError,new o(t),new o(i),"not strictly equal to")},this.areLike=function(t,i,e,n){if(r.isNil(t)){if(r.isNil(i))return}else if(!r.isNil(i)&&t==i)return;throw new s(n,e,this.unitTest,this.testCollection,innerError,new o(t),new o(i))},this.areNotLike=function(t,i,e,n){if(r.isNil(t)){if(!r.isNil(i))return}else if(r.isNil(i)||t!=i)return;throw new s(n,e,this.unitTest,this.testCollection,innerError,new o(t),new o(i),"not equal to")},this.isLessThan=function(t,i,e,n){if(r.isNil(t)||!(r.isNil(i)||i<t))throw new s(n,e,this.unitTest,this.testCollection,innerError,new o(t),new o(i),"is less than")},this.notLessThan=function(t,i,e,n){if(!(r.isNil(t)||!r.isNil(i)&&t<=i))throw new s(n,e,this.unitTest,this.testCollection,innerError,new o(t),new o(i),"is not less than")},this.isGreaterThan=function(t,i,e,n){if(r.isNil(i)||!(r.isNil(t)||t<i))throw new s(n,e,this.unitTest,this.testCollection,innerError,new o(t),new o(i),"is greater than")},this.notGreaterThan=function(t,i,e,n){if(!(r.isNil(i)||!r.isNil(t)&&i<=t))throw new s(n,e,this.unitTest,this.testCollection,innerError,new o(t),new o(i),"is not greater than")},this.isTrue=function(t,i,e){return this.areLike(!0,t,i,e)},this.isFalse=function(t,i,e){return this.areLike(!1,t,i,e)}}return t.fail=t.prototype.fail,t.isNil=t.prototype.isNil,t.notNil=t.prototype.notNil,t.is=t.prototype.is,t.isNot=t.prototype.isNot,t.areEqual=t.prototype.areEqual,t.areNotEqual=t.prototype.areNotEqual,t.areLike=t.prototype.areLike,t.areNotLike=t.prototype.areNotLike,t.isLessThan=t.prototype.isLessThan,t.notLessThan=t.prototype.notLessThan,t.isGreaterThan=t.prototype.isGreaterThan,t.notGreaterThan=t.prototype.notGreaterThan,t.isTrue=t.prototype.isTrue,t.isFalse=t.prototype.isFalse,t}(JsUnitTesting.Utility,JsUnitTesting.AssertionError,JsUnitTesting.TypeSpec);