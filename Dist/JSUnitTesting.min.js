var JsUnitTesting=JsUnitTesting||{};JsUnitTesting.Utility=function(t){return(t=t||{}).isNil=function(t){return null==t},t.toArray=function(t){return void 0===t?[]:null!==t&&t instanceof Array?t:[t]},t.mapArray=function(i,n,e){var s,r=[];if(i=t.toArray(),t.isNil(n))s=function(t){return n(i[t],t,i)};else{if("function"!=typeof n)throw"callback must be a callback if it is defined";s=function(t){return n.call(e,i[t],t,i)}}if(0==i.length)return r;for(var o=0;o<i.length;o++)r.push(s(o));return r},t.filterArray=function(i,n,e){var s,r=[];if(i=t.toArray(),t.isNil(n))s=function(t){return n(i[t],t,i)};else{if("function"!=typeof n)throw"callback must be a callback if it is defined";s=function(t){return n.call(e,i[t],t,i)}}if(0==i.length)return r;for(var o=0;o<i.length;o++)s(o)&&r.push(i[o]);return r},t.reduceArray=function(i,n,e,s){var r;if(i=t.toArray(),t.isNil(n))r=function(t,e){return n(e,i[t],t,i)};else{if("function"!=typeof n)throw"callback must be a callback if it is defined";r=function(t,e){return n.call(s,e,i[t],t,i)}}var o=e;if(0==i.length)return o;null===typeof o&&(o=i[i.length-1]);for(var u=0;u<i.length;u++)o=r(o,u);return o},t.convertToString=function(i,n){if(t.isNil(i))return void 0===n?i:null===n?n:t.convertToString(n);switch(typeof i){case"string":return i;case"number":case"boolean":return i.toString()}return JSON.stringify(i)},t.convertToNumber=function(i,n){if(t.isNil(i))return void 0===n?i:null===n?n:t.convertToNumber(n);switch(typeof i){case"number":if(!isNaN(i))return i;break;case"boolean":return i?1:0;default:if(i instanceof Date)return i.valueOf();var e=t.convertToString(i,"").trim();if(e.length>0)try{var s=parseInt(e);try{var r=parseFloat(e);i=isNaN(s)?r:isNaN(r)||!Number.isFinite(r)?s:Number.isFinite(s)&&s==r?s:r}catch(t){i=s}}catch(t){i=Number.NaN}else i=Number.NaN;if(!isNaN(i))return i}return void 0===n?i:null===n?n:t.convertToNumber(n)},t.getFunctionName=function(t){if(null!=t){if("function"==typeof t&&"string"==typeof t.name&&t.name.length>0)return t.name;if("function"==typeof t.constructor&&"string"==typeof t.constructor.name&&t.constructor.name.length>0)return t.constructor.name;var i;if(void 0!==t.prototype&&null!==t.prototype&&"function"==typeof t.prototype.constructor)i=t.prototype;else{var n=Object.getPrototypeOf(t);null!=n&&"function"==typeof n.constructor&&(i=n)}if(null!=i&&"string"==typeof i.constructor.name&&i.constructor.name.length>0)return i.constructor.name;var e=/^function\s+([^(]+)/i.exec(t.toString());if(null!=e)return e[1]}return""},t}(JsUnitTesting.Utility),JsUnitTesting.TypeSpec=function(t){function i(n){if(this.prototypeChain=[],this.is=function(t){if(null==t||!(t instanceof i))return this.is(new i(t));if(this.prototypeChain.length<t.prototypeChain.length)return!1;if(this.type!=t.type)return!(this.prototypeChain.length>0)&&("(nil)"===this.type?"(null)"===t.type||"undefined"===t.type:"(nil)"===t.type&&("(null)"===this.type||"undefined"===this.type));for(var n=this.prototypeChain.length-t.prototypeChain.length,e=0;e<t.prototypeChain.length;e++)if(this.prototypeChain[e+n]!=t.prototypeChain[e])return!1;return!0},0==arguments.length)return this.value=null,void(this.type="(nil)");if(this.value=n,2!=arguments.length){if(this.type=i.getTypeName(n),"undefined"!=this.type&&"(null)"!=this.type){var e=Object.getPrototypeOf(n);for(t.isNil(e)&&(e=n.prototype);!t.isNil(e);){var s=i.getTypeName(e);"object"!==s&&"function"!==s&&this.prototypeChain.push(s),e=Object.getPrototypeOf(e),t.isNil(e)&&(e=e.prototype)}}}else this.type=t.convertToString(arguments[1],i.getTypeName(n))}return i.getTypeName=function(n){var e,s=typeof n;if("function"===s){if("string"==typeof n.name&&n.name.length>0)return n.name;if(e=t.getFunctionName(n),!t.isNil(e))return e}else{if("object"!==s)return s;if(null===n)return"(null)"}if("function"==typeof n.constructor&&"function"!==(e=i.getTypeName(n.constructor))&&"object"!==e)return e;if(!t.isNil(n.prototype)&&"function"!==(e=i.getTypeName(n.prototype))&&"object"!==e)return e;var r=Object.getPrototypeOf(n);return t.isNil(r)||"function"===(e=i.getTypeName(r))?s:e},i.is=function(t,n){return new i(t).is(new i(n))},i}(JsUnitTesting.Utility),JsUnitTesting.TestResult=function(t,i,n){return function(e,s,r,o,u,l){this.status=n.NotEvaluated,this.error=null,this.unitTestId=null,this.unitTestName=null,this.testCollectionId=null,this.testCollectionName=null,this.message=f.message;var a=function(t,i){var n=new Assert(r,o);return t.apply(n,i)},f={stateInfo:l,unitTestId:t.isNil(u)?t.isNil(r.id)?null:r.id:u,unitTestName:r.name,testCollectionId:t.isNil(o)?null:o.id,testCollectionName:t.isNil(o)?null:o.name,status:n.Inconclusive};try{if(this.result=new i(a.call(this,e,r.args)),"function"==typeof s){var h=a.call(this,s,[result.value]);if("boolean"==typeof h)this.success=h;else{var c=t.convertToString(h,"").trim();c.length>0&&(t.convertToString(f.message,"").trim().length>0?f.message+="\n\n"+c:f.message=c),this.success=!0}}else void 0===f.success?(this.success=void 0===f.error||null===f.error,this.success||(this.error=f.error)):(void 0!==f.error&&null!==f.error||(this.error=f.error),this.success=f.success&&!0);this.uncaughtExceptionOcurred=!1}catch(t){this.uncaughtExceptionOcurred=!0,void 0===this.evaluationFinished&&(this.evaluationFinished=!1,this.result=new i),this.success=!1,this.error=t}"string"!=typeof f.message&&(f.message=t.convertToString(f.message,"").trim()),0==f.message.length&&(f.message=this.success?"Success":"Fail",t.isNil(this.error)||(f.message=t.convertToString(this.error,f.message).trim())),this.unitTestId=t.isNil(u)?t.isNil(r.id)?null:r.id:u,this.unitTestName=r.name,this.testCollectionId=t.isNil(o)?null:o.id,this.testCollectionName=t.isNil(o)?null:o.name,this.message=f.message}}(JsUnitTesting.Utility,JsUnitTesting.TypeSpec,JsUnitTesting.ResultStatus),JsUnitTesting.UnitTest=function(t,i,n){return function(t,n,e,s,r,o){if("function"!=typeof t){if(void 0===t)throw"testFunc must be defined";if(null===t)throw"testFunc cannot be null";throw"evaluator must be a function"}if("function"!=typeof o&&null!==o)throw"assertion must be a function if it is defined";void 0===(r=JsUnitTesting.Utility.convertToNumber(r))||null==r||isNaN(r)||(this.id=r),(e=JsUnitTesting.Utility.convertToString(e,"")).trim().length>0?this.name=e:(e=JsUnitTesting.Utility.getFunctionName(t),void 0!==this.id&&(e=0==e.length?this.id.toString():e+" ["+this.id+"]")),this.name=e,this.description=JsUnitTesting.Utility.convertToString(s,""),this.toString=function(){return this.toJSON()},this.toJSON=function(){JSON.stringify({args:this.args,name:this.name,description:this.description,id:this.id})},this.valueOf=function(){return void 0===this.id?Number.NaN:this.id},this.exec=function(n,e,s){return new i(t,o,this,n,e,s)}}}(JsUnitTesting.Utility,JsUnitTesting.TestResult,JsUnitTesting.ResultStatus),JsUnitTesting.TestCollection=function(t,i){return function(e,s,r){var o={name:t.convertToString(s),id:t.convertToNumber(r),notRun:[],resultInfo:[]};this.name=o.name,this.id=o.id,this.add=function(){(function(){for(var n=0;n<arguments.length;n++)for(var e=t.toArray(arguments[n]),s=0;s<e.length;s++)void 0!==e[s]&&null!==e[s]&&e[s]instanceof i&&this.notRun.push(e[s])}).apply(o,arguments)},this.clear=function(){(function(){this.notRun=[],this.resultInfo=[]}).call(o)},this.getPassedTests=function(){return t.mapArray(t.filterArray(o.resultInfo,function(t){return t.result.passed}),function(t){return t.test})},this.getFailedTests=function(){return t.mapArray(t.filterArray(o.resultInfo,function(t){return!t.result.passed}),function(t){return t.test})},this.getResults=function(){return t.mapArray(o.resultInfo,function(t){return!t.result.passed})},this.allPassed=function(){for(var t=0;t<o.resultInfo.length;t++)if(!o.resultInfo[t].result.passed)return!1;return!0},this.anyPassed=function(){for(var t=0;t<o.resultInfo.length;t++)if(o.resultInfo[t].result.passed)return!0;return!1},this.run=function(){return function(){for(var i=0,e=0,s=t.mapArray(this.resultInfo,function(t){return t.result.testId}),r={},o=[];this.notRun.length>0;){var u=this.notRun.pop();if(t.nil(u))return null;e++;var l=u.id;"number"==typeof l&&!isNaN(l)&&Number.isFinite(l)||(l=0);for(var a=!0,f=0;f<s.length;f++)if(s[f]==n){a=!1;break}if(!a){var h=function(t){for(var i=0;i<this.completed.length;i++)if("number"==typeof(n=this.completed[i].id)&&!isNaN(n)&&Number.isFinite(n)&&n==t)return!0;for(i=0;i<this.notRun.length;i++){var n;if("number"==typeof(n=this.notRun[i].id)&&!isNaN(n)&&Number.isFinite(n)&&n==t)return!0}return!1};do{l++}while(h(l))}s.push(l);var c=u.exec(this,l,r);this.resultInfo.push({test:u,result:c}),o.push(c),c.passed&&i++}return{passed:i,failed:e-passed,results:o}}.call(o)},this.runAll=function(){return function(){for(var i=0,e=t.mapArray(this.resultInfo,function(t){return t.test}),s=0;s<e.length;s++)this.notRun.push(e[s]);this.resultInfo=[];for(var r=[],o={};this.notRun.length>0;){var u=this.notRun.pop();if(t.nil(u))return null;var l=u.id;"number"==typeof l&&!isNaN(l)&&Number.isFinite(l)||(l=0);var a=!0;for(s=0;s<r.length;s++)if(r[s]==n){a=!1;break}if(!a){var f=function(t){for(var i=0;i<this.completed.length;i++)if("number"==typeof(n=this.completed[i].id)&&!isNaN(n)&&Number.isFinite(n)&&n==t)return!0;for(i=0;i<this.notRun.length;i++){var n;if("number"==typeof(n=this.notRun[i].id)&&!isNaN(n)&&Number.isFinite(n)&&n==t)return!0}return!1};do{l++}while(f(l))}r.push(l);var h=u.exec(this,l,o);this.resultInfo.push({test:u,result:h}),h.passed&&i++}return{passed:i,failed:this.resultInfo.count-i,results:this.getResults()}}.call(o)},this.runFailed=function(){for(var i=0,e=0,s=t.mapArray(t.filterArray(o.resultInfo,function(t){return!t.result.passed}),function(t){return t.test}),r=0;r<this.notRun.length;r++)s.push(this.notRun[r]);this.notRun=s,o.resultInfo=t.filterArray(o.resultInfo,function(t){return t.result.passed});for(var u=t.mapArray(o.resultInfo,function(t){return t.result.testId}),l={},a=[];this.notRun.length>0;){var f=this.notRun.pop();if(t.nil(f))return null;e++;var h=f.id;"number"==typeof h&&!isNaN(h)&&Number.isFinite(h)||(h=0);var c=!0;for(r=0;r<u.length;r++)if(u[r]==n){c=!1;break}if(!c){var p=function(t){for(var i=0;i<this.completed.length;i++)if("number"==typeof(n=this.completed[i].id)&&!isNaN(n)&&Number.isFinite(n)&&n==t)return!0;for(i=0;i<this.notRun.length;i++){var n;if("number"==typeof(n=this.notRun[i].id)&&!isNaN(n)&&Number.isFinite(n)&&n==t)return!0}return!1};do{h++}while(p(h))}u.push(h);var g=f.exec(this,h,l);o.resultInfo.push({test:f,result:g}),a.push(g),g.passed&&i++}return{passCount:i,failed:e-i,results:a}},this.add(e)}}(JsUnitTesting.Utility,JsUnitTesting.UnitTest),JsUnitTesting.AssertionError=function(t,i,n){function e(i,e,s,r,o,u,l,a){e=t.convertToString(e),null!==(i=t.convertToNumber(i,null))&&Number.isFinite(i)?(this.errorNumber=i,e=0==e.length?"Error "+i:"Error "+i+": "+e):0==e.length&&(e="Unexpected Error"),Error.prototype.constructor.call(this,e),t.isNil(o)?this.innerError="":this.innerError=o,t.isNil(s)?(this.unitTestId="",this.unitTestName=""):(t.isNil(s.id)?this.unitTestId="":this.unitTestId=s.id,t.isNil(s.name)?this.unitTestName="":this.unitTestName=s.name),t.isNil(r)?(this.testCollectionId="",this.testCollectionName=""):(t.isNil(r.id)?this.testCollectionId="":this.testCollectionId=r.id,t.isNil(r.name)?this.testCollectionName="":this.testCollectionName=r.name),a=t.convertToString(a,""),this.condition=0==a.length?"equal to":a,t.isNil(u)?this.expected={}:this.expected=u instanceof n?u:new n(u),t.isNil(l)?this.actual={}:this.actual=l instanceof n?l:new n(l)}return e.prototype=Error.prototype,e.prototype.constructor=e,e}(JsUnitTesting.Utility,JsUnitTesting.UnitTest,JsUnitTesting.TypeSpec),JsUnitTesting.Assert=function(t,i,n){return function(e,s){if(t.isNil(e))throw"JsUnitTesting.UnitTest object must be provided...";if(!(e instanceof JsUnitTesting.UnitTest))throw"The unit test object must be an instance of JsUnitTesting.UnitTest";if(!(t.isNil(s)||s instanceof JsUnitTesting.TestCollection))throw"If test collection is provided, it must be an instance of JsUnitTesting.TestCollection";this.fail=function(t,n,e){throw new i(n,t,this.unitTest,this.testCollection,e,void 0,void 0,"fail")},this.isNil=function(e,s,r){if(!t.isNil(e))throw new i(r,s,this.unitTest,this.testCollection,innerError,new n,new n(e),"is nil")},this.notNil=function(e,s,r){if(t.isNil(e))throw new i(r,s,this.unitTest,this.testCollection,innerError,new n,new n(e),"not nil")},this.is=function(t,e,s,r){if(!n.is(e,t))throw new i(r,s,this.unitTest,this.testCollection,innerError,new n(t),new n(e))},this.isNot=function(t,e,s,r){if(n.is(e,t))throw new i(r,s,this.unitTest,this.testCollection,innerError,new n(t),new n(e),"is not")},this.areEqual=function(t,e,s,r){var o=typeof t;if(o!==typeof e||"undefined"!==o&&null!==t&&t!==e)throw new i(r,s,this.unitTest,this.testCollection,innerError,new n(t),new n(e),"strictly equal to")},this.areNotEqual=function(t,e,s,r){var o=typeof t;if(o===typeof e&&("undefined"===o||null===t||t===e))throw new i(r,s,this.unitTest,this.testCollection,innerError,new n(t),new n(e),"not strictly equal to")},this.areLike=function(e,s,r,o){if(t.isNil(e)){if(t.isNil(s))return}else if(!t.isNil(s)&&e==s)return;throw new i(o,r,this.unitTest,this.testCollection,innerError,new n(e),new n(s))},this.areNotLike=function(e,s,r,o){if(t.isNil(e)){if(!t.isNil(s))return}else if(t.isNil(s)||e!=s)return;throw new i(o,r,this.unitTest,this.testCollection,innerError,new n(e),new n(s),"not equal to")},this.isLessThan=function(e,s,r,o){if(t.isNil(e)||!(t.isNil(s)||s<e))throw new i(o,r,this.unitTest,this.testCollection,innerError,new n(e),new n(s),"is less than")},this.notLessThan=function(e,s,r,o){if(!(t.isNil(e)||!t.isNil(s)&&s>=e))throw new i(o,r,this.unitTest,this.testCollection,innerError,new n(e),new n(s),"is not less than")},this.isGreaterThan=function(e,s,r,o){if(t.isNil(s)||!(t.isNil(e)||s>e))throw new i(o,r,this.unitTest,this.testCollection,innerError,new n(e),new n(s),"is greater than")},this.notGreaterThan=function(e,s,r,o){if(!(t.isNil(s)||!t.isNil(e)&&s<=e))throw new i(o,r,this.unitTest,this.testCollection,innerError,new n(e),new n(s),"is not greater than")},this.isTrue=function(t,i,n){return this.areLike(!0,t,i,n)},this.isFalse=function(t,i,n){return this.areLike(!1,t,i,n)}}}(JsUnitTesting.Utility,JsUnitTesting.AssertionError,JsUnitTesting.TypeSpec);